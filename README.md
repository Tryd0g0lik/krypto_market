[![CryptoMarket](https://github.com/Tryd0g0lik/krypto_market/actions/workflows/main.yml/badge.svg?branch=dev)](https://github.com/Tryd0g0lik/krypto_market/actions/workflows/main.yml)

Note: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞—Ä—É—à–∏–ª–æ —É—Å–ª–æ–≤–∏–π –∑–∞–¥–∞–Ω–∏—è 
–°—É—Ç—å —Ä–∞–±–æ—Ç—ã: 
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Deribit (crypto –±–∏—Ä–∂–∞).
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞  –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–∞ –ø–æ ticker-—É —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º.
- –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏.
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –¥–∞—Ç—ã.

## APP CryptoMarket


–ú—ã –∑–Ω–∞–µ–º - –ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º. –ù–æ —ç—Ç–æ –≤ –û–û–ü. –¢—É—Ç –∂–µ –≥–æ–≤–æ—Ä—é –æ —Ü–µ–ª–æ–º APP. –°—Ç–∞—Ä–∞—é—Å—å –¥–µ–ª–∞—Ç—å –µ–¥–∏–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á \
–∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ args/kwargs

---
–î–∞, –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —Ä–∞–±–æ—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª–µ–µ 10 –¥–Ω–µ–π —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ deadline. –ù–æ –∏ \
–¥–µ–ª–∞—Ç—å –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "–∞ –ª–∏—à—å –±—ã –±—ã–ª–æ" –Ω–µ—Ç –∂–µ–ª–∞–Ω–∏—è. \
–î–∞, –º–æ–≥ —Å–¥–µ–ª–∞—Ç—å:
- HTTP –∑–∞–ø—Ä–æ—Å—ã –Ω–∞–ø—Ä—è–º—É—é –ø–æ –≤–Ω–µ—à–Ω–µ–º—É API.
- –ë–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è. 
- –ë–µ–∑ update –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- –ë–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏ –¥–∞–Ω–Ω—ã—Ö.
- –° –æ–¥–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

–ù–æ, —Å–¥–µ–ª–∞–ª:
- SSE, WSS, HTTP.
- –ø–ª–∞–Ω–æ–≤–æ–µ –∏ –ø–æ –º–µ—Ä–µ –∑–∞–ø—Ä–æ—Å–∞ - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ.
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.
- —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π (–Ω–µ –ø—É—Ç–∞—Ç—å —Å —Ö–µ—à–µ–º –∏ –∫–µ—à–µ–º).
- —Å –¥–≤—É–º—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. –î–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é "`DEBUG`" –∏–∑ "`.ENV`".
- –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∏/–∏–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –¥—Ä–∞–π–≤–µ—Ä–µ, –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∑ –±–∞–∑—ã ("`SQLite`" & "`PostgreSQL`").
- –ó–∞–ø—É—Å–∫–∞—è docker-compose –∞—Ä—Ä —Å–∞–º–æ —Å–æ–∑–¥–∞—ë—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ–≤–µ—Ä—è—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ–º (`DEBUG` —É–∫–∞–∂–∏—Ç–µ `Fasle`) schema "`crypto`".
- –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç "`DEBUG`" —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–º–µ—é—Ç —Å–≤–æ—ë —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è.
- —Ñ–∞–π–ª swagger –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤ Postman.
 web-api —Å–ø–∏—Å–æ–∫ –ø–æ url –Ω–∏–∂–µ.

–†–∞–±–æ—Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç 3-—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞ –∫–æ—Ç–æ—Ä—É—é –≥–æ—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. 

 - –í 1-–æ–π –≤–µ—Ä—Å–∏–∏. –ö–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º access —Ç–æ–∫–µ–Ω, –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –î–∞–ª–µ–µ –ø–æ —Ç–æ–∫–µ–Ω—É –¥–µ–ª–∞–µ–º –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è \
   –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ù–æ —Ç–æ–∫–µ–Ω –≤—ã–¥–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –Ω–∞ —Å–µ—Å—Å–∏—é/–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Deribit —Ç–æ–∫–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ –±—ã–ª–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.  
 - –í 2-–æ–π –ü–æ–ª—É—á–∏–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ç—Ä–∞—Ñ–∏–∫—É (–¥–æ 15 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É). –°—Ç–∞–ª —Ç–µ—Ä—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ (asyncio.Queue).
 - –ö–æ–≥–¥–∞ –æ–¥–∏–Ω API –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ—Ç APP 9–∞ –Ω–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∏–∑ db. –°–Ω–∏–∂–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É.

–í–æ–∑–º–æ–∂–Ω–æ —Å—Ç–æ–∏—Ç —É—á–µ—Å—Ç—å, —á—Ç–æ —Å —ç—Ç–æ–π –±–∏—Ä–∂–µ–π —Ä–∞–±–æ—Ç–∞–ª –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑. –†–∞–±–æ—Ç–∞ –±—ã–ª–∞ –±–µ–∑ –∫–∞–∫–æ–≥–æ –ª–∏–±–æ –¢–ó, –≤—Å—ë —Å–æ–∑–¥–∞–≤–∞–ª–æ—Å—å –Ω–∞ —Ö–æ–¥—É.\
–í—Å—ë —ç—Ç–æ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ –≤—Ä–µ–º—è.


### –ö–æ—Ä–æ—Ç–∫–æ 
[![Logic_visualization.png](img/Logic_visualization.png)](img/Logic_visualization.png)


–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–µ—Å–Ω—ã–π –±–ª–æ–∫ –≤ –ø—Ä–æ–º–µ–∂—É—Ç–∫–µ –º–µ–∂–¥—É –æ—Å–Ω–æ–≤–Ω—ã–º –∞—Ä—Ä –∏ Deribit.\
[–ò–º–µ–µ—Ç —Å–≤–æ—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö](cryptomarket/models):
 - "`crypto_person`" –æ–Ω–∞ –∂–µ "`crypto.person`";
 - "`crypto_person_prices`" –æ–Ω–∞ –∂–µ "`crypto.person_prices`";
 - "`crypto_price_tickers`" –æ–Ω–∞ –∂–µ "`crypto.price_tickers`". 
–î–ª—è –ª—ë–≥–∫–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è —Ç–∞–±–ª–∏—Ü (–≤ –Ω–µ–¥—Ä–∞—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö) –¥–ª—è SQLite –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ—Ñ–∏–∫—Å "`crypto_`", \
a –¥–ª—è PostgreSQL –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ "`crypto`" —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏.

**–í .ENV —Ñ–∞–π–ª–µ:**\
–ú–µ–Ω—è–µ–º "`True`" –Ω–∞ "`False`" –∏–ª–∏ "`False`" –Ω–∞ "`True`":
 - –µ—Å–ª–∏ "`True`" [—Ä–∞–±–æ—Ç–∞–µ–º —Å](cryptomarket/database) PostgreSQL. "`PROJECT_MODE`" –≤ —Ä–µ–∂–∏–º–∞—Ö: "`testing`", "`development`", "`production`" - —á—Ç–æ–± –Ω–µ –≥—Ä–æ—Ö–Ω—É—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
 - –µ—Å–ª–∏ "`False`" —Ä–∞–±–æ—Ç–∞–µ–º SQLite.

**–ü—Ä–æ –ø–∞—Ç–æ–∫–∏**
–ù–∞ —ç—Ç–∞–ø–µ –∑–∞–ø—É—Å–∫–∞ –¥–≤–∏–∂–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —É–ø–∞–∫–æ–≤–∫–∞ –∏–∑ 10-—Ç–∏ –∫–æ—Ä—É—Ç–∏–Ω–æ–≤.\
–ö–∞–∂–¥—ã–π –∫–æ—Ä—É—Ç–∏–Ω - client [–¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Deribit](cryptomarket/deribit_client/deribit_clients.py)./
–ü–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—è –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –∫–æ—Ä—É—Ç–∏–Ω –∏ –æ–±—Ä–∞—â–∞–µ—Å—è –∫ Deribit. \
–ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã—Ç–∞—â–∏–ª–∏ –∏–∑ –∫–æ—Ä–æ–±–∫–∏ –æ–¥–∏–Ω –∫–æ—Ä—É—Ç–∏–Ω, —Ç—É–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π –∫–æ—Ä—É—Ç–∏–Ω –∏ –æ–ø—è—Ç—å –∏—Ö 10 —à—Ç. –í—Å–µ —ç—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã\
–Ω–µ –∑–∞–Ω–∏–º–∞—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö. –ù–æ —ç—Ç–æ –Ω–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö. 

**–ü—Ä–æ Docker**
[docker-compose](docker-compose.yml) –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞—Å—Ö–æ–¥ –ø–∞–º—è—Ç–∏ RAM. –Ø —Ä–∞–±–æ—Ç–∞—é –Ω–∞ —Ç–∞—Ä–∏—Ñ–µ —Å 1G RAM. –ü–æ—ç—Ç–æ–º—É \
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –ª–∏–º–∏—Ç–∞–º –≤ docker-compose –ø—Ä–∏—à–ª–æ—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å Swap-—Ñ–∞–π–ª (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞) –∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:
- "`adminer`";
- "`flower`". –û–Ω–∏ —Ä–∞–±–æ—á–∏–µ –∏ –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–ª–æ–∫–∏ –∏ —É–±–µ—Ä–∏—Ç–µ –ª–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏ (–Ω–∞ –≤—Å—ë–º docker-compose) –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.

![Adminer –∑–∞–∫–æ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω](./img/adminer_database.png)

#### Note
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∏](cryptomarket/project/settings/core.py) –ø–æ –∂–µ–ª–∞–Ω–∏—é.
- [Celery](cryptomarket/project/celery_.py).
- [–ú–æ–¥–µ–ª–∏](cryptomarket/models) –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- [–ú–µ–Ω–µ–¥–∂–µ—Ä](cryptomarket/deribit_client) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Deribit.
- C Deribit —Ä–∞–±–æ—Ç–∞–µ–º [—á–µ—Ä–µ–∑ WebSocket](cryptomarket/deribit_client/deribit_websocket.py)
- –í—Å–µ –±–ª–æ–∫–∏ (Celery, App, Database –∏ –ó–∞–¥–∞—á–∏), –º–µ–∂–¥—É —Å–æ–±–æ–π —Ä–∞–±–æ—Ç–∞—é —á–µ—Ä–µ–∑ cache.

## –ß—Ç–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

Person —á—Ç–æ–± –∞—Ä—Ä –Ω–µ:
- –∑–∞–≤–∏—Å–µ–ª–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
- –∏ –Ω–µ –Ω–µ—Å–ª–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

1. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–æ SSE. 
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ticker –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ crypto-–±–∏—Ä–∂–∏. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å "`btc_usd`"\
    –∑–∞—Ç–µ–º —Å "`eth_usd`" –∏ –∂–¥—ë–º –¥–∞–Ω–Ω—ã—Ö –≤ SSE –ª–µ–Ω—Ç–µ.
3. –í–æ–∑–º–æ–∂–Ω–æ –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –∏–ª–∏ –≤—Å–µ—Ö —Ä–∞–∑–æ–º.
4. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ —Ñ–∏–ª—å—Ç—Ä—É –¥–∞—Ç. –ü—Ä–∏ —ç—Ç–æ–º "`start_date`" –º–µ–Ω—å—à–µ "`end_date`" (datetime —Å—Ç—Ä–æ–≥–æ –ø–æ —à–∞–±–ª–æ–Ω—É). –ú–æ–∂–Ω–æ –∏ –±–µ–∑ "`end_date`".  

----

### –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–æ SSE
–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∏:
- –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ SSE.
- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ Deribit OAuth. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–∞–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–æ–ª—É—á–∞–µ–º \
access tokens –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–º—è, –ø–æ—á—Ç—É). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –≤–∏–¥–µ –æ–±—Ä–∞–∑–∞ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ª–∏—á–Ω–æ—Å—Ç–∏) [—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ](cryptomarket/deribit_client/deribit_person.py),\
–∏ –Ω–∞ 27 —á–∞—Å–æ–≤ –≤ –∫–µ—à–µ. –ß–µ—Ä–µ–∑ –∑–∞–¥–∞—á—É –∏ Celery –≤ –ø–æ–ª–Ω–æ—á—å –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Å–µ—Ä–≤–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ \
–¥–∞–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –Ω–µ —Å–æ–∑–¥–∞–Ω/–≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω (–Ω–æ –µ—Å–ª–∏ –Ω–∞–¥–æ, —Å–¥–µ–ª–∞—é). –î–∞–Ω–Ω—ã–µ (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏) –≤ –∫–µ—à–µ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.

-Authentication https://docs.deribit.com/articles/authentication 

#### Note
–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SSE –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ "`client_id`" & "`client_secret`".\

–ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ **—à–∏—Ñ—Ä—É—é—Ç—Å—è**. –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –æ—Ç —à–∏—Ñ—Ä–∞ —á–µ—Ä–µ–∑ –∫–µ—à –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫ –º–µ—Å—Ç—É –≥–¥–µ\
"`client_id`" & "`client_secret`" –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é.

–£–∂–µ –∏–∑ –∫–µ—à–∞ , –∫–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º —ç—Ç–æ—Ç –∫–ª—é—á (–≤ –æ–¥–Ω–æ–π –∏–∑ –∑–∞–¥–∞—á–∏) —Ç–æ –¥–µ-—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\
–î–∞–Ω–Ω—ã–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–µ—à–∏—Ä—É–µ–º –Ω–∞ 27 —á–∞—Å–æ–≤. 

–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–∞–∑–æ–≤—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á —à–∏—Ñ—Ä–∞ –Ω–∞ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (time live 10-15 —Å–µ–∫—É–Ω–¥). 
–ö–ª—é—á–∏ —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞. 

![SSE](./img/postgres_result.png)

----
### Celery
- "`task_add_...`" –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–ø—Ä–∞–≤–ª—è—é  (—Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –≤—Ä–µ–º–µ–Ω–∏ 50 —Å–µ–∫—É–Ω–¥) \
–∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫—É—Ä—Å—É –≤–∞–ª—é—Ç—ã. \
- "`task_send_....`" –∫–∞–∂–¥—ã–µ 45 —Å–µ–∫—É–Ω–¥ –∑–∞–≥–ª—è–¥—ã–≤–∞–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (SQLite or PostgreSQL) –±–µ—Ä—ë—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∫–µ—à —É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è SSE.

| **–°–¥–µ–ª–∞–π—Ç–µ**                                                  **–∫–ª–∏–∫**                          |
|:------------------------------------------------------------------------------------------------|
| **Celery –Ω–∞ 127.0.0.1**                                                                         |
| [![—Å—É–¥—É–∫–Ωcelery](./img/celery_deribit.png)](./img/celery_deribit.png)                           |
| **Celery beat –Ω–∞ –≤–Ω–µ—à–Ω–µ–º IP**                                                                   |
| [![postgres_celery_beanr](./img/postgres_celery_beanr.png)](./img/postgres_celery_beanr.png)    |
| **Celery worker –Ω–∞ –≤–Ω–µ—à–Ω–µ–º IP**                                                                              |
| [![postgres_celery_worker](./img/postgres_celery_worker.png)](./img/postgres_celery_worker.png) |
|                                                                                                 |

<details closed>
<summary>–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –º–æ–∂–Ω–æ –¥–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Å–¥–µ–ª–∞–π –∫–ª–∏–∫):</summary>


## üìä **–û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏**

### **1. –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏**
- **–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤:** 8 586
- **–°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:** ~14.13 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞:** ~10 –º–∏–Ω—É—Ç (607 —Å–µ–∫—É–Ω–¥)
- **–û—à–∏–±–∫–∏:** 0% ‚Äî **–æ—Ç–ª–∏—á–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏!**

## üìà **–ê–Ω–∞–ª–∏–∑ –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º**

### **–≠–Ω–¥–ø–æ–∏–Ω—Ç 1: `GET v1_currency` (–ø—Ä–æ—Å—Ç–∞—è –≤—ã–±–æ—Ä–∫–∞)**
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|---------|----------|--------|
| **RPS** | 7.06 | –ù–æ—Ä–º–∞–ª—å–Ω–æ |
| **Avg time** | 81 –º—Å | üü¢ –û—Ç–ª–∏—á–Ω–æ |
| **P95** | 129 –º—Å | üü¢ –û—Ç–ª–∏—á–Ω–æ |
| **P99** | 162 –º—Å | üü¢ –û—Ç–ª–∏—á–Ω–æ |

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞:** –≠–Ω–¥–ø–æ–∏–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ. –î–∞–∂–µ –≤ 1% —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ 162 –º—Å ‚Äî —ç—Ç–æ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è API.

### **–≠–Ω–¥–ø–æ–∏–Ω—Ç 2: `GET v1_currency_filter` (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π)**
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|---------|----------|--------|
| **RPS** | 7.05 | –ù–æ—Ä–º–∞–ª—å–Ω–æ |
| **Avg time** | 369 –º—Å | üü° –°—Ä–µ–¥–Ω–µ |
| **P95** | 833 –º—Å | üü° –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è |
| **P99** | 962 –º—Å | üü†Êé•Ëøë –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º—É |

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞:** –≠–Ω–¥–ø–æ–∏–Ω—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ –≤ 4-5 —Ä–∞–∑. –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ, –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î. –û–¥–Ω–∞–∫–æ P99 –±–ª–∏–∑–æ–∫ –∫ 1 —Å–µ–∫—É–Ω–¥–µ ‚Äî —ç—Ç–æ –ø–æ–≥—Ä–∞–Ω–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞.

## üìä **–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | v1_currency | v1_currency_filter | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-------------|-------------------|---------|
| Avg time | 81 –º—Å | 369 –º—Å | ‚¨ÜÔ∏è 4.6x |
| P95 | 129 –º—Å | 833 –º—Å | ‚¨ÜÔ∏è 6.5x |
| P99 | 162 –º—Å | 962 –º—Å | ‚¨ÜÔ∏è 5.9x |

**–í—ã–≤–æ–¥:** –≠–Ω–¥–ø–æ–∏–Ω—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –ª–∏–Ω–µ–π–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —á—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

## üö¶ **–û—Ü–µ–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã**

### **–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- ‚úÖ **0% –æ—à–∏–±–æ–∫** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π –±–µ–∑ —Å–±–æ–µ–≤
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ—Ç —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
- ‚úÖ **–•–æ—Ä–æ—à–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å** ‚Äî 14 rps –¥–ª—è 1GB —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ—Å—Ç–æ–π–Ω–æ

### **–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:**
- ‚ö†Ô∏è **P99 –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** (962 –º—Å) ‚Äî –±–ª–∏–∑–æ–∫ –∫ 1 —Å–µ–∫—É–Ω–¥–µ
- ‚ö†Ô∏è **–†–∞–∑–±—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–∏** –Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: –æ—Ç 116 –º—Å –¥–æ 1221 –º—Å (10x —Ä–∞–∑–Ω–∏—Ü–∞)

## üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

### **–î–ª—è `v1_currency_filter`:**
1. **–ò–Ω–¥–µ–∫—Å—ã –≤ –ë–î:** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º—ã–º –ø–æ–ª—è–º
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –¥–æ–±–∞–≤–∏—Ç—å Redis-–∫—ç—à –¥–ª—è —á–∞—Å—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ JOIN-–æ–≤ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å
4. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:** –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö

### **–î–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (1GB RAM):**
–í–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Ö–æ—Ä–æ—à–∏ –¥–ª—è 1GB —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏:
- **300K –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å** ‚Äî —Ç–µ–∫—É—â–∞—è –º–æ—â–Ω–æ—Å—Ç—å
- **500K+ –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å** ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–ª–∏ –∞–ø–≥—Ä–µ–π–¥

## üìã **–ò—Ç–æ–≥–æ–≤–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞**

> –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–≤—ã—Å–æ–∫—É—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** (0% –æ—à–∏–±–æ–∫) –∏ **—Ö–æ—Ä–æ—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –≠–Ω–¥–ø–æ–∏–Ω—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (14 rps) —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å–ª—É–∂–∏—Ç –¥–æ–ª–≥–æ –±–µ–∑ —Å–±–æ–µ–≤.

**–û—Ü–µ–Ω–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏:** üü¢ –ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞ (—Å–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–ø–∞—Å–æ–º)
</details>

----
### –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–¢—Ä–∏ –º–æ–¥–µ–ª–∏, –Ω–æ –ø–æ —Ñ–∞–∫—Ç–æ —Ä–∞–±–æ—á–∞—è [—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞](cryptomarket/models/schemes/model_prices.py). \
–î–≤–µ –¥—Ä—É–≥–∏–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–∏–∫—Ä–æ-—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –±–ª–æ–∫–∞.

|**–°–¥–µ–ª–∞–π—Ç–µ**||**–∫–ª–∏–∫**|
|:-----|:-----|:-----|
|[![view_database](./img/database_view.png)](./img/database_view.png)|[![dabase](./img/dabase.png)](./img/dabase.png)|[![data](./img/Postgres_data.png)](./img/Postgres_data.png)|
||||

----
### Log –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ - —Å–±–æ—Ä–∫–∞ Prodo
*–°–¥–µ–ª–∞–π—Ç–µ –∫–ª–∏–∫ –ø–æ —Å–∫—Ä–∏–Ω—É.*

|**Docker**||**PostgreSQL**||**Redis**||**APP**||
|:-----|:-----|:-----|:-----|:-----|:-----|:-----|:-----|
| [![docker_remorte](./img/docker_remorte.png)](./img/docker_remorte.png) ||[![log_cryptomarket_postgres_data](./img/log_cryptomarket_postgres_data.png)](./img/log_cryptomarket_postgres_data.png)||[![log_cryptomarket_redis_data](./img/log_cryptomarket_redis_data.png)](./img/log_cryptomarket_redis_data.png)||[![log_cryptomarket_static](./img/log_cryptomarket_static.png)](./img/log_cryptomarket_static.png)||
|||||||[![logs](./img/logs.png)](./img/logs.png)||

#### Note
–õ–æ–≥–∏ app –∫–æ–≥–¥–∞ –∫–æ–¥ –æ–±–≤–µ—Ä–Ω—É—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é –∫–æ–Ω—Ç—Ä–æ–ª—è/—É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏. –°–µ–π—á–∞—Å –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–Ω—è—Ç. –°–∞–º–∞ [—Ñ—É–Ω–∫—Ü–∏—è —Ç—É—Ç](cryptomarket/project/functions.py).



## Tree
```text
root
‚îú‚îÄ‚îÄ .github
‚îÇ   |   ‚îî‚îÄ‚îÄworkflows
‚îÇ   |       ‚îî‚îÄ‚îÄmain.yml
‚îú‚îÄ‚îÄ __tests__
‚îÇ   |   ‚îú‚îÄ‚îÄfixtures
‚îÇ   |   |   ‚îî‚îÄ‚îÄ.py
‚îÇ   |   ‚îú‚îÄ‚îÄtest_database_connections
‚îÇ   |   |   ‚îî‚îÄ‚îÄ.py
‚îÇ   |   ‚îú‚îÄ‚îÄtest_derbit_clients
‚îÇ   |   |   ‚îî‚îÄ‚îÄ.py
‚îÇ   |   ‚îî‚îÄ‚îÄtest_midllware
‚îÇ   |       ‚îî‚îÄ‚îÄ.py
‚îú‚îÄ‚îÄ alembic
‚îú‚îÄ‚îÄ cryptomarket
‚îÇ   ‚îú‚îÄ‚îÄapi
‚îÇ   |   ‚îú‚îÄ‚îÄv1
‚îÇ   |   |    ‚îî‚îÄ‚îÄ.py
‚îÇ   |   ‚îú‚îÄ‚îÄv2
‚îÇ   |   |    ‚îî‚îÄ‚îÄ.py
‚îÇ   |   ‚îî‚îÄ‚îÄ.py
‚îÇ   ‚îú‚îÄ‚îÄdatabase
‚îÇ   |   ‚îî‚îÄ‚îÄ*.py
‚îÇ   ‚îú‚îÄ‚îÄderibit_client
‚îÇ   |   ‚îî‚îÄ‚îÄ*.py
‚îÇ   ‚îú‚îÄ‚îÄerrors
‚îÇ   |   ‚îî‚îÄ‚îÄ*.py
‚îÇ   ‚îú‚îÄ‚îÄmodels
‚îÇ   |   ‚îú‚îÄ‚îÄpersons
‚îÇ   |   |    ‚îî‚îÄ‚îÄ*.py
‚îÇ   |   ‚îú‚îÄ‚îÄschemes
‚îÇ   |        ‚îî‚îÄ‚îÄ*.py
‚îÇ   ‚îú‚îÄ‚îÄproject
‚îÇ   |   ‚îú‚îÄ‚îÄsettings
‚îÇ   |   ‚îî‚îÄ‚îÄ*.py
‚îÇ   |
‚îÇ   ‚îú‚îÄ‚îÄtasks
‚îÇ   |   ‚îú‚îÄ‚îÄcelery
‚îÇ   |   |    ‚îî‚îÄ‚îÄ*.py
‚îÇ   |   ‚îî‚îÄ‚îÄqueues
‚îÇ   |        ‚îî‚îÄ‚îÄ*.py
‚îÇ   ‚îú‚îÄ‚îÄtype
‚îÇ   |   ‚îî‚îÄ‚îÄ*.py
‚îú‚îÄ‚îÄ img
‚îú‚îÄ‚îÄ nginx
‚îú‚îÄ‚îÄ .coverage
‚îú‚îÄ‚îÄ .dockerignore
‚îú‚îÄ‚îÄ .editorconfig
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .flake8
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .pre-commit-config.yaml
‚îú‚îÄ‚îÄ .pylintrc
‚îú‚îÄ‚îÄ alembic.ini
‚îú‚îÄ‚îÄ celerybeat-schedule
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ log_putout.log
‚îú‚îÄ‚îÄ logs.py
‚îú‚îÄ‚îÄ poetry.lock
‚îú‚îÄ‚îÄ pull.exp
‚îú‚îÄ‚îÄ pull.sh
‚îú‚îÄ‚îÄ pytest.ini
‚îú‚îÄ‚îÄ README.md

```
## .ENV Files
```text
APP_PROTOCOL=http
APP_HOST=127.0.0.1
APP_PORT=8003
REDIS_URL=redis://< external_server_host >:< external_server_port >
REDIS_DB=0
REDIS_HOST=< IP/domen_of_host >
REDIS_PORT=< port >

DEBUG=True # True That mean You are working in local SQLIte database  

REDIS_MASTER_NAME=< user_By_ssh_of_external_server >
REDIS_PASSWORD= < password_By_ssh_of_external_server > 

POSTGRES_USER= < user_database >
POSTGRES_PASSWORD= < password_database >
POSTGRES_PORT=< port_database>
POSTGRES_HOST=db
POSTGRES_DB=< dabase_name >

COMPOSE_PROJECT_NAME= < project_name >

FLOWER_USER= < user_login > # Firs you need uncomment the block flower from docker-compose file.
FLOWER_PASSWORD= < user)password >


## view dababase when you are working on the 'DEBUG=False' (above) mode
#PROJECT_MODE=testing # If You want. Note/ I self wark on the 'development'. 
## For development
PROJECT_MODE=development
## Prodo 
#PROJECT_MODE=production # for external IP/database. If you want. 

```

## Celery worker & beat
||||
|:----|:----|:----|
|[![celery worker](./img/celery_cache.png)](./img/celery_cache.png)||[![celery worker](./img/celery_deribit.png)](./img/celery_deribit.png)|

## Testing 
![test](./img/test_console.png)

## Postman Test
|v1_currency API||log Server|
|:-----|:-----|:-----|
|[![postman test](./img/postman_test.png)](./img/postman_test.png)||[![Postmane_test_server_log](img/Postmane_test_server_log.png)](img/Postmane_test_server_log.png)|
|v1_currency_filter API|||
|[![postman test](./img/Postmane_test_server_2.png)](./img/Postmane_test_server_2.png)||[![Postmane_test_server_log](img/Postmane_test_server_log_2.png)](img/Postmane_test_server_log_2.png)|
|database at the time of testing|||
|[![postman test](./img/Postman_test_db.png)](./img/Postman_test_db.png)|||

----
## Commands
```
# =====================
# FastAPI
# =====================

uvicorn main:app --host 0.0.0.0 --port 8003 --reload

# =====================
# GITHUB
# =====================

git clone <url_repo.git > # - –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π 
git log --all --oneline --graph --decorate --date=format:'%Y-%m-%d %H:%M:%S' --pretty=format:'%C(yellow)%h%C(auto)%d %C(white)%cd%Creset %s' # - –∏—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞

# =====================
# CICD & GITHUB ACTIONS
# =====================

# == pull.exp
#!/usr/bin/expect -f
set timeout 600
spawn /home/< user name >/crypto/pull.sh
expect "password"
send "< your password >\r"
expect eof

# == pull.sh
#!/bin/bash
cd /home/< user name >/crypto || { echo "Directory not found"; exit 1; }

# Git pull —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
echo "Updating code from git..."
git pull --ff-only origin dev || { echo "Git pull failed"; exit 1; }

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
safe_exec() {
    if ! "$@"; then
        echo "Warning: Command failed: $*"
        return 1
    fi
    return 0
}

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ Docker Compose
echo "Stopping Docker Compose services..."
safe_exec sudo docker compose down

# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º –¢–û–õ–¨–ö–û –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º
echo "Cleaning up project containers..."
PROJECT_CONTAINERS=$(sudo docker ps -a --filter "name=cryptomarket" --filter "name=fastapi" -q)
if [ -n "$PROJECT_CONTAINERS" ]; then
    sudo docker stop $PROJECT_CONTAINERS 2>/dev/null || true
    sudo docker rm -f $PROJECT_CONTAINERS 2>/dev/null || true
    echo "‚úì Project containers removed"
fi

# 2. –£–¥–∞–ª—è–µ–º –∑–∞–≤–∏—Å—à–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–Ω–µ –≤—Å–µ!)
echo "Removing dangling containers..."
sudo docker container prune -f || true

# 3. –£–¥–∞–ª—è–µ–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã, –Ω–æ –°–û–•–†–ê–ù–Ø–ï–ú –±–∞–∑–æ–≤—ã–µ
echo "Cleaning up unused images (keeping base images)..."
# –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–∑—ã —Å —Ç–µ–≥–æ–º <none> (dangling)
sudo docker image prune -f || true
# –ù–µ —É–¥–∞–ª—è–µ–º –≤—Å–µ –æ–±—Ä–∞–∑—ã! –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: sudo docker rmi $(sudo docker images -q) - –ù–ï –î–ï–õ–ê–ï–ú!

# 4. –£–¥–∞–ª—è–µ–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–æ–º–∞ (volumes) –ø—Ä–æ–µ–∫—Ç–∞
echo "Cleaning up unused volumes..."
# –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–º–∞ –±–µ–∑ –º–µ—Ç–æ–∫ –∏–ª–∏ —Å—Ç–∞—Ä—ã–µ
sudo docker volume ls -qf dangling=true | xargs -r sudo docker volume rm || true

# 5. –£–¥–∞–ª—è–µ–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ç–∏
echo "Cleaning up unused networks..."
sudo docker network prune -f || true

# 6. –û—á–∏—Å—Ç–∫–∞ –±–∏–ª–¥–µ—Ä–∞ (BuildKit cache)
echo "Cleaning up builder cache..."
sudo docker builder prune -f || true

# 7. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –≤–µ—Ä—Å–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# echo "Keeping only recent images..."
# sudo docker image prune -a --filter "until=24h" -f || true

echo "Pulling latest images (if needed)..."
sudo docker compose pull || true

echo "Starting services..."
sudo docker compose -f ./docker-compose.yml up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
echo "Checking service status..."
sleep 5
sudo docker compose ps

echo "‚úÖ Deployment completed successfully"


# =====================
# CELERY
# =====================
  
celery -A cryptomarket.project.celery_ worker --loglevel=info --pool=solo 
 # 'solo' - –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ windows.
 # '--concurrency=1'  –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ Celery (–ü–æ –∂–µ–ª–∞–Ω–∏—é) —É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É.    
celery -A cryptomarket.project.celery_ beat --loglevel=info

# =====================
# SWAP –¥–ª—è –ø–æ–¥–∫–∞—á–∫–∏ —Ä–µ—Å—Å—É—Ä—Å–æ–≤ –Ω–∞ —Å–ª–∞–±—ã–π —Å–µ—Ä–≤–µ—Ä
# =====================

# –°–æ–∑–¥–∞–µ–º swap-—Ñ–∞–π–ª 2GB
sudo fallocate -l 2G /swapfile
# –∏–ª–∏
# –ï—Å–ª–∏ fallocate –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
sudo dd if=/dev/zero of=/swapfile bs=1M count=2048

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo chmod 600 /swapfile

# –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø–æ–¥ swap
sudo mkswap /swapfile

# –í–∫–ª—é—á–∞–µ–º swap
sudo swapon /swapfile

# –ü—Ä–æ–≤–µ—Ä—è–µ–º
free -h
# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å: Swap: 2.0G

# –î–µ–ª–∞–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```
----

## Swagger
| **WEB Swagger**                                                                                    || **WEB Swagger**                                                    || **Swagger Postman**                                           |
|:---------------------------------------------------------------------------------------------------|:----|:-------------------------------------------------------------------|:----|:--------------------------------------------------------------|
| [![Swagger web](./img/swagger_web.png)](./img/swagger_web.png)                                     || [![Swagger web](./img/swsagger_web_2.png)](./img/swsagger_web_2.png)|| [![Swagger web](./img/swagger_web.png)](./img/swagger_web.png)|
| [—Ñ–∞–π–ª swagger](CryptoMarket.postman_collection.json)                                               ||                                                                    ||                                                               |

----

## URL 
```text
{URL}/docs # root OpenApi 
{URL}/redoc # root OpenApi
{URL}//health # Health check endpoint
```
## API
```text
GET: {URL}/api/v2/sse/connection # Connection SSE
GET: {URL}/api/v1/market/{user_id}/create_order/{ticker} # Subscriptions
GET: {URL}/api/v1/market/{{x_user_id}}/cancel_order/{{ticker}} # Remove one subscription 
GET: {URL}/api/v1/market/{user_id}/cancel_all_orders # Remove all subscriptions
GET: {URL}http://127.0.0.1:8003/api/v1/market/{user_id}/get_order/{ticker} # Filter dates
 
```
